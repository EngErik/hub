apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'application'

if (project.ext.properties.get('isDevBuild') == null) {
    project.ext.isDevBuild = !project.ext.properties.containsKey("buildConfig") || !"release".equals(project.ext.buildConfig)
}

repositories {
    mavenCentral()
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

project.ext.jenkinsBuildNumber = "$System.env.VERSION_NUMBER"
project.ext.jenkinsJobName = "hub-v2"

group = 'com.flightstats'

version = project.ext.jenkinsBuildNumber

project.ext.isDevBuild = !project.ext.properties.containsKey("buildConfig") || !"release".equals(project.ext.buildConfig)

println "Building version: ${version}"

buildDir = 'build'

mainClassName = "com.flightstats.hub.app.SingleHubMain"

configurations {
    all*.exclude(group: 'org.slf4j', module: 'slf4j-log4j12')
    all*.exclude(module: 'log4j')
    integrationTests
}

dependencies {

    compile 'org.eclipse.jetty:jetty-server:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-webapp:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-servlet:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-util:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-http:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-io:9.2.7.v20150116'
    compile 'org.eclipse.jetty:jetty-security:9.2.7.v20150116'
    compile 'org.eclipse.jetty.websocket:websocket-server:9.2.7.v20150116'
    compile 'org.eclipse.jetty.websocket:websocket-common:9.2.7.v20150116'
    compile 'org.eclipse.jetty.websocket:javax-websocket-client-impl:9.2.7.v20150116'
    compile 'org.eclipse.jetty.websocket:javax-websocket-server-impl:9.2.7.v20150116'
    compile 'com.sun.jersey:jersey-bundle:1.19'
    compile 'com.sun.jersey:jersey-client:1.19'
    compile 'com.sun.jersey.contribs:jersey-guice:1.19'
    compile 'com.fasterxml.jackson.core:jackson-core:2.4.3'
    compile 'com.fasterxml.jackson.core:jackson-annotations:2.4.3'
    compile 'com.fasterxml.jackson.core:jackson-databind:2.4.3'
    compile 'com.fasterxml.jackson.jaxrs:jackson-jaxrs-json-provider:2.4.3'
    compile 'com.fasterxml.jackson.datatype:jackson-datatype-guava:2.4.3'
    compile 'javax.servlet:javax.servlet-api:3.1.0'
    compile 'javax.ws.rs:jsr311-api:1.1.1'
    compile 'commons-codec:commons-codec:1.9'
    compile 'org.glassfish:javax.servlet:3.1.1'
    compile 'com.google.inject:guice:4.0-beta5'
    compile 'com.google.inject.extensions:guice-servlet:4.0-beta5'
    compile 'com.google.guava:guava:18.0'
    compile 'joda-time:joda-time:2.7'
    compile 'org.hamcrest:hamcrest-core:1.3'
    compile 'ch.qos.logback:logback-core:1.1.2'
    compile 'ch.qos.logback:logback-classic:1.1.2'
    compile 'org.slf4j:jul-to-slf4j:1.7.7'
    compile 'com.intellij:annotations:12.0'
    compile 'org.reflections:reflections:0.9.9'
    compile 'org.slf4j:log4j-over-slf4j:1.7.7'
    compile 'org.slf4j:jcl-over-slf4j:1.7.7'
    compile 'com.amazonaws:aws-java-sdk:1.9.2'
    compile 'org.apache.curator:curator-recipes:2.6.0'
    compile 'org.apache.commons:commons-lang3:3.2'
    compile 'commons-io:commons-io:2.4'
    compile 'com.github.rholder:guava-retrying:1.0.6'
    compile 'com.google.code.gson:gson:2.3'
    compile 'com.newrelic.agent.java:newrelic-agent:3.14.0'
    compile 'com.newrelic.agent.java:newrelic-api:3.14.0'
    compile 'org.projectlombok:lombok:1.14.8'
    compile 'net.logstash.logback:logstash-logback-encoder:4.2'

    testCompile 'com.sparkjava:spark-core:2.0.0'
    testCompile 'junit:junit:4.+'
    testCompile "org.mockito:mockito-all:1.10.8"
    testCompile 'org.apache.curator:curator-test:2.6.0'
}


distTar {
    compression = Compression.GZIP
}

applicationDistribution.from('README.md') {
    into "doc"
}

applicationDistribution.from('config/triforce') {
    into "triforce"
}

